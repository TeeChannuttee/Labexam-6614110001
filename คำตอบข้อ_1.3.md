# คำตอบข้อ 1.3) อธิบายการใช้ Key และ Widget

## ก) จะใช้ Key ประเภทไหน ตรงไหน เพราะอะไร?

### ใช้ ValueKey ในรายการ Look ทั้งหมด

**ตำแหน่งที่ใช้:**
- ใน `all_looks_screen.dart` ที่ ReorderableListView
- ใน `swipe_mode_screen.dart` สำหรับการ์ดแต่ละใบ

**โค้ดตัวอย่าง:**
```dart
Dismissible(
  key: ValueKey(look.id),  // ใช้ ValueKey กับ unique ID
  // ...
)
```

**เหตุผล:**
1. **Uniqueness**: แต่ละ Look มี `id` ที่ไม่ซ้ำกัน (ใช้ UUID)
2. **Performance**: ValueKey เหมาะกับข้อมูลที่มีค่า primitive (String, int) ที่ unique
3. **State Preservation**: เมื่อจัดเรียงใหม่หรือลบรายการ Flutter จะรู้ว่า widget ไหนคือ widget เดิม
4. **ReorderableListView**: ต้องการ unique key เพื่อติดตามตำแหน่งของแต่ละ item
5. **Dismissible**: ต้องการ unique key เพื่อระบุ item ที่ถูกปัด

**ทำไมไม่ใช้ Key อื่น:**
- ObjectKey: ไม่เหมาะเพราะต้อง compare object ทั้งหมด (ช้ากว่า)
- UniqueKey: จะสร้างใหม่ทุกครั้งที่ rebuild (ทำให้เสีย state)
- GlobalKey: ใช้เมื่อต้องเข้าถึง widget จากที่อื่น (ไม่จำเป็นในกรณีนี้)

---

## ข) Dismissible และ ReorderableListView จะอยู่หน้าไหน ทำหน้าที่อะไร?

### อยู่ในหน้า All Looks Screen (หน้าหลักแสดงรายการลุค)

**ReorderableListView:**

**ทำหน้าที่:**
- แสดงรายการ Look ทั้งหมดในแนวตั้ง
- อนุญาตให้ผู้ใช้ลากจับ drag handle (≡≡) เพื่อจัดเรียงลำดับใหม่
- บันทึกลำดับใหม่ลง SharedPreferences

**การทำงาน:**
```dart
ReorderableListView.builder(
  onReorder: (oldIndex, newIndex) {
    provider.reorderLooks(oldIndex, newIndex);  // อัพเดตลำดับ
  },
  itemBuilder: (context, index) {
    // สร้าง list items
  }
)
```

**Dismissible:**

**ทำหน้าที่:**
- **ปัดซ้าย (left)** = ลบรายการ (สีแดง, ไอคอน delete)
  - แสดง confirm dialog ก่อนลบจริง
  - ลบออกจาก provider และ SharedPreferences
- **ปัดขวา (right)** = แก้ไขรายการ (สีน้ำเงิน, ไอคอน edit)
  - เปิด dialog แก้ไขชื่อ, สไตล์, ความมั่นใจ

**การทำงาน:**
```dart
Dismissible(
  key: ValueKey(look.id),
  background: Container(color: Colors.red),      // ปัดซ้าย = ลบ
  secondaryBackground: Container(color: Colors.blue),  // ปัดขวา = แก้ไข
  confirmDismiss: (direction) async {
    if (direction == DismissDirection.startToEnd) {
      return await showDialog(...);  // Confirm delete
    } else {
      _showEditDialog(look);  // Show edit dialog
      return false;  // ไม่ลบ
    }
  },
  onDismissed: (direction) {
    provider.deleteLook(look.id);  // ลบจริงถ้า confirm
  },
)
```

**เหตุผลที่ใช้ร่วมกัน:**
- ReorderableListView + Dismissible ทำให้ผู้ใช้จัดการรายการได้หลากหลาย
- ครอบคลุมทั้ง: ดู, เรียงลำดับ, แก้ไข, ลบ

---

## ค) ฟอร์มจะมี field อะไรบ้าง และจะ validate อย่างไร?

### หน้า Add Look Screen มี 4 Fields:

### 1. ชื่อชุด (Outfit Name)
**ประเภท:** TextFormField

**Validation:**
```dart
validator: (value) {
  if (value == null || value.trim().isEmpty) {
    return 'กรุณากรอกชื่อชุด';
  }
  if (value.trim().length < 2) {
    return 'ชื่อชุดต้องมีอย่างน้อย 2 ตัวอักษร';
  }
  return null;
}
```

**เงื่อนไข:**
- ห้ามเว้นว่าง (required)
- ความยาวขั้นต่ำ 2 ตัวอักษร

---

### 2. สไตล์ (Style)
**ประเภท:** DropdownButtonFormField<String>

**Validation:**
```dart
validator: (value) {
  if (value == null || value.isEmpty) {
    return 'กรุณาเลือกสไตล์';
  }
  return null;
}
```

**ตัวเลือก:**
- Minimal
- Street
- Korean
- Vintage

**เงื่อนไข:**
- ต้องเลือก 1 อย่าง (required)

---

### 3. ระดับความมั่นใจ (Confidence Level)
**ประเภท:** TextFormField (รับค่าตัวเลข 1-5)

**Validation:**
```dart
validator: (value) {
  if (value == null || value.isEmpty) {
    return 'กรุณากรอกระดับความมั่นใจ';
  }
  final number = int.tryParse(value);
  if (number == null) {
    return 'กรุณากรอกเฉพาะตัวเลข';
  }
  if (number < 1 || number > 5) {
    return 'ระดับความมั่นใจต้องอยู่ระหว่าง 1-5';
  }
  return null;
}
```

**เงื่อนไข:**
- ต้องเป็นตัวเลข (not null)
- ค่าระหว่าง 1-5 เท่านั้น
- แสดงเป็นดาวสีทอง (⭐) จำนวนตามค่าที่กรอก

---

### 4. รูปภาพลุค (Look Image)
**ประเภท:** Image Picker (ไม่ใช่ FormField แต่มี validation แยก)

**Validation:**
```dart
void _saveLook() {
  if (_formKey.currentState!.validate()) {
    if (_imagePath == null || _imageBytes == null) {
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(content: Text('กรุณาเลือกรูปภาพ')),
      );
      return;  // ไม่ให้บันทึกถ้าไม่มีรูป
    }
    // บันทึก Look
  }
}
```

**เงื่อนไข:**
- ต้องเลือกรูปภาพ (required)
- รองรับทั้ง camera และ gallery
- บันทึกเป็น Uint8List (bytes) เพื่อรองรับ web

---

### การทำงานของฟอร์ม:

**1. Form Key:**
```dart
final _formKey = GlobalKey<FormState>();
```

**2. การ Validate:**
```dart
if (_formKey.currentState!.validate()) {
  // ทุก field ผ่าน validation แล้ว
  // ตรวจสอบรูปภาพเพิ่มเติม
  // บันทึก Look
}
```

**3. การบันทึก:**
- เรียก `validate()` บน FormKey
- ตรวจสอบรูปภาพ
- สร้าง Look object พร้อม imageBytes
- เพิ่มเข้า Provider
- บันทึกลง SharedPreferences
- กลับหน้า All Looks

**4. UX Enhancements:**
- แสดง error message สีแดงใต้แต่ละ field
- ปุ่ม Save มี animation (ScaleTransition)
- แสดง SnackBar เมื่อบันทึกสำเร็จ
- แสดงตัวอย่างรูป real-time

---

## สรุป

| หัวข้อ | รายละเอียด |
|--------|-----------|
| **Key** | ValueKey(look.id) เพื่อ uniqueness และ performance |
| **Dismissible** | ปัดซ้าย=ลบ, ปัดขวา=แก้ไข ในหน้า All Looks |
| **ReorderableListView** | จัดเรียงลำดับในหน้า All Looks |
| **Form Fields** | 4 fields: ชื่อ (2+ chars), สไตล์ (dropdown), ความมั่นใจ (1-5), รูปภาพ (required) |
| **Validation** | ครบทุก field + custom logic สำหรับแต่ละประเภท |

---

**จัดทำโดย:** Antigravity  
**วันที่:** 19 มกราคม 2026
